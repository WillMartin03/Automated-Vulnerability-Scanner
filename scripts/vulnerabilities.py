import os, subprocess, platform, shutil, winreg as reg, installer

def createList():
	portlist = []
	try:
		with open("./ports.txt", "r") as f:
			for line in f:
				line = line.strip()
				if line == "\x90":
					break
				portlist.append(line)
		return portlist
	except Exception as e:
		print(e)
		print("Error detected, exiting...")
		exit()

def start(ip):
	installer.msf()
	print("Start Vulnerability Scan...")
	portlist = createList()
	for i in range(len(portlist)):
		scan(ip, portlist[i])

def scan(ip, port):
	#result = subprocess.run(f"msfconsole -q -x \"use auxiliary/scanner/portscan/tcp; set RHOSTS {ip}; set RPORT {port}; run\"", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
	#if (result.returncode == 0):
	#	print(result.stdout)
	#else:
	#	print(result.stderr)
	return

if __name__ == "__main__":
	print(f"Starting from {os.path.basename(__file__)}. This is usually for developer purposes, please make sure this is intentional.\nIf you want to run the full program, please execute the 'AVS.py' file instead.")
	start(input("Enter IP Address: "))